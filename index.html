<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Mini-Alchemy</title>
  <style>
    :root {
      --primary: #4a6fa5;
      --secondary: #166088;
      --accent: #4fc3f7;
      --background: #f8f9fa;
      --card-bg: #ffffff;
      --text: #333333;
      --success: #2e7d32;
      --error: #c62828;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: var(--background);
      color: var(--text);
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: var(--secondary);
      margin-bottom: 30px;
      font-size: 2.5rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    #message {
      text-align: center;
      font-weight: bold;
      min-height: 24px;
      margin: 20px 0;
      padding: 10px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    
    .message-success {
      background-color: rgba(46, 125, 50, 0.1);
      color: var(--success);
      border-left: 4px solid var(--success);
    }
    
    .message-error {
      background-color: rgba(198, 40, 40, 0.1);
      color: var(--error);
      border-left: 4px solid var(--error);
    }
    
    .message-info {
      background-color: rgba(33, 150, 243, 0.1);
      color: var(--secondary);
      border-left: 4px solid var(--secondary);
    }
    
    #elements {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .element {
      padding: 15px 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: var(--card-bg);
      user-select: none;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .element::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--accent);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .element:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .element:hover::before {
      transform: scaleX(1);
    }
    
    .element.dragging {
      opacity: 0.7;
      cursor: grabbing;
      transform: scale(0.95);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .element.selected {
      background: #fff9c4;
      box-shadow: 0 0 0 2px var(--accent);
    }
    
    #buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1000;
    }
    
    button {
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      user-select: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    button:hover {
      background: var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .progress-container {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 8px;
      margin: 20px 0;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 10px;
      background-color: var(--accent);
      border-radius: 8px;
      transition: width 0.5s ease;
    }
    
    /* New styles for combination info */
    .combination-info {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
      background: var(--card-bg);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .info-column {
      padding: 10px;
    }
    
    .info-column h3 {
      margin-top: 0;
      color: var(--secondary);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 5px;
    }
    
    .info-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .info-list li {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    
    @media (max-width: 768px) {
      #elements {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
      
      .element {
        padding: 12px 8px;
        font-size: 14px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .combination-info {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1 id="title">Little Alchemy</h1>
  
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  
  <div id="message"></div>
  
  <!-- New combination info section -->
  <div class="combination-info">
    <div class="info-column">
      <h3>–ù–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</h3>
      <ul class="info-list" id="basicElements"></ul>
    </div>
    <div class="info-column">
      <h3>–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</h3>
      <ul class="info-list" id="discoveredElements"></ul>
    </div>
    <div class="info-column">
      <h3>–°–∫—Ä–µ—â–∏–≤–∞–Ω–∏–µ</h3>
      <ul class="info-list" id="combinationHistory"></ul>
    </div>
    <div class="info-column">
      <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
      <ul class="info-list" id="resultHistory"></ul>
    </div>
  </div>
  
  <div id="elements"></div>

  <div id="buttons">
    <button id="toggleModeBtn">
      <span id="modeIcon">üì±</span>
      <span id="modeText">–í–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤</span>
    </button>
  </div>

  <script>
    const data = {
      ru: {
        title: 'Little Alchemy',
        elements: ['–í–æ–¥–∞', '–û–≥–æ–Ω—å', '–ó–µ–º–ª—è', '–í–æ–∑–¥—É—Ö', '–°–æ–ª–Ω—Ü–µ', '–ú–µ—Ç–∞–ª–ª', '–•–ª–µ–±'],
        combinations: {
          '–í–æ–¥–∞+–û–≥–æ–Ω—å': '–ü–∞—Ä',
          '–í–æ–¥–∞+–ó–µ–º–ª—è': '–ì—Ä—è–∑—å',
          '–í–æ–¥–∞+–í–æ–∑–¥—É—Ö': '–¢—É–º–∞–Ω',
          '–í–æ–¥–∞+–°–æ–ª–Ω—Ü–µ': '–†–æ—Å–∞',
          '–í–æ–¥–∞+–ú–µ—Ç–∞–ª–ª': '–ê–ª—é–º–∏–Ω–Ω–∏–π',
          '–í–æ–¥–∞+–•–ª–µ–±': '–¢–µ—Å—Ç–æ',
          '–û–≥–æ–Ω—å+–ó–µ–º–ª—è': '–õ–∞–≤–∞',
          '–û–≥–æ–Ω—å+–í–æ–∑–¥—É—Ö': '–î–∞–≤–ª–µ–Ω–∏–µ',
          '–î–∞–≤–ª–µ–Ω–∏–µ+–°–ø–ª–∞–≤': '–ö–∞–º–µ–Ω—å',
          '–û–≥–æ–Ω—å+–°–æ–ª–Ω—Ü–µ': '–°–≤–µ—Ç',
          '–û–≥–æ–Ω—å+–ú–µ—Ç–∞–ª–ª': '–°–ø–ª–∞–≤',
          '–û–≥–æ–Ω—å+–•–ª–µ–±': '–ü–µ–ø–µ–ª',
          '–ó–µ–º–ª—è+–í–æ–∑–¥—É—Ö': '–ü—ã–ª—å',
          '–ó–µ–º–ª—è+–°–æ–ª–Ω—Ü–µ': '–ó–µ–º–ª–∏',
          '–ó–µ–º–ª—è+–•–ª–µ–±': '–ü—à–µ–Ω–∏—Ü–∞',
          '–õ–∞–≤–∞+–î–∞–≤–ª–µ–Ω–∏–µ': '–°–∂–∞—Ç–∏–µ',
          '–°–∂–∞—Ç–∏–µ+–°–≤–µ—Ç': '–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ',
          '–í–æ–∑–¥—É—Ö+–î–∞–≤–ª–µ–Ω–∏–µ': '–û–±–ª–∞–∫–æ',
          '–û–±–ª–∞–∫–æ+–í–æ–¥–∞': '–î–æ–∂–¥—å',
          '–î–æ–∂–¥—å+–í–æ–¥–∞': '–õ—É–∂–∞',
          '–õ—É–∂–∞+–ì—Ä—è–∑—å': '–ë–æ–ª–æ—Ç–æ',
          '–î–æ–∂–¥—å+–°–≤–µ—Ç': '–†–∞–¥—É–≥–∞',
          '–î–∞–≤–ª–µ–Ω–∏–µ+–ö–∞–º–µ–Ω—å': '–ì–æ—Ä–∞',
          '–ì–æ—Ä–∞+–í–æ–¥–∞': '–†–µ—á–∫–∞',
          '–†–µ—á–∫–∞+–í–æ–¥–∞': '–ú–æ—Ä–µ',
          '–ú–æ—Ä–µ+–°–∂–∞—Ç–∏–µ': '–û–∑–µ—Ä–æ',
          '–ú–æ—Ä–µ+–í–æ–¥–∞': '–û–∫–µ–∞–Ω',
          '–î–∞–≤–ª–µ–Ω–∏–µ+–°–≤–µ—Ç': '–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞',
          '–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞+–ó–µ–º–ª–∏': '–ü–ª–∞–Ω–µ—Ç–∞',
          '–ì—Ä—è–∑—å+–î–∞–≤–ª–µ–Ω–∏–µ': '–ü–æ—á–≤–∞',
          '–ü–æ—á–≤–∞+–î–æ–∂–¥—å': '–†–∞—Å—Ç–µ–Ω–∏–µ',
          '–†–∞—Å—Ç–µ–Ω–∏–µ+–í–æ–¥–∞': '–í–æ–¥–æ—Ä–æ—Å–ª–∏',
          '–†–∞—Å—Ç–µ–Ω–∏–µ+–î–æ–∂–¥—å': '–¢—Ä–∞–≤–∞',
          '–¢—Ä–∞–≤–∞+–°–≤–µ—Ç': '–°–∞–¥',
          '–î–∞–≤–ª–µ–Ω–∏–µ+–û–≥–æ–Ω—å': '–≠–Ω–µ—Ä–≥–∏—è',
          '–≠–Ω–µ—Ä–≥–∏—è+–î–∞–≤–ª–µ–Ω–∏–µ': '–ú–∞—Ç–µ—Ä–∏—è',
          '–ú–∞—Ç–µ—Ä–∏—è+–ü–ª–∞–Ω–µ—Ç–∞': '–ö–æ—Å–º–æ—Å',
          '–≠–Ω–µ—Ä–≥–∏—è+–ë–æ–ª–æ—Ç–æ': '–ñ–∏–∑–Ω—å',
          '–ñ–∏–∑–Ω—å+–ì—Ä—è–∑—å': '–ß–µ–ª–æ–≤–µ–∫',
          '–ß–µ–ª–æ–≤–µ–∫+–°–∞–¥': '–°–∞–¥–æ–≤–æ–¥',
          '–ß–µ–ª–æ–≤–µ–∫+–ü–æ—á–≤–∞': '–§–µ—Ä–º–µ—Ä',
          '–§–µ—Ä–º–µ—Ä+–ü–æ—á–≤–∞': '–§–µ—Ä–º–∞',
          '–§–µ—Ä–º–∞+–ñ–∏–∑–Ω—å': '–ñ–∏–≤–æ—Ç–Ω–æ–µ',
          '–ñ–∏–≤–æ—Ç–Ω–æ–µ+–í–æ–∑–¥—É—Ö': '–ö–æ–∑–∞',
          '–ö–æ–∑–∞+–ß–µ–ª–æ–≤–µ–∫': '–ö–∞–¥—ã—Ä–æ–≤',
          '–í–æ–∑–¥—É—Ö+–≠–Ω–µ—Ä–≥–∏—è': '–í–µ—Ç–µ—Ä',
          '–≠–Ω–µ—Ä–≥–∏—è+–ß–µ–ª–æ–≤–µ–∫': '–°–∏–ª–∞',
          '–°–∏–ª–∞+–í–µ—Ç–µ—Ä': '–ë—É—Ä—è',
          '–ë—É—Ä—è+–ü—ã–ª—å': '–ü—ã–ª—å–Ω–∞—è –ë—É—Ä—è',
          '–í–æ–¥–∞+–ü–∞—Ä': '–ó–∞–º–æ—Ä–æ–∑–∫–∞',
          '–ó–∞–º–æ—Ä–æ–∑–∫–∞+–í–æ–¥–∞': '–õ—ë–¥',
          '–õ—ë–¥+–ó–µ–º–ª—è': '–°–Ω–µ–≥',
          '–°–Ω–µ–≥+–ì–æ—Ä–∞': '–õ–∞–≤–∏–Ω–∞',
          '–ì–æ—Ä–∞+–õ–∞–≤–∏–Ω–∞': '–ö–∞—Ç–æ—Å—Ç—Ä–æ—Ñ–∞',
          '–ö–∞—Ç–æ—Å—Ç—Ä–æ—Ñ–∞+–í–æ–¥–∞': '–¶—É–Ω–∞–º–∏',
          '–ö–∞—Ç–æ—Å—Ç—Ä–æ—Ñ–∞+–õ–∞–≤–∞': '–ò–∑–≤–µ—Ä–∂–µ–Ω–∏–µ',
          '–ö–∞—Ç–æ—Å—Ç—Ä–æ—Ñ–∞+–ó–µ–º–ª—è': '–ó–µ–º–ª—è—Ç—Ä—è—Å–µ–Ω–∏–µ',
          '–î–∞–≤–ª–µ–Ω–∏–µ+–ö–∞—Ç–æ—Å—Ç—Ä–æ—Ñ–∞': '–í–∑—Ä—ã–≤',
          '–í–∑—Ä—ã–≤+–î–∞–≤–ª–µ–Ω–∏–µ': '–£—Ä–∞–Ω',
          '–£—Ä–∞–Ω+–°–∂–∞—Ç–∏–µ': '–ú–æ–ª–µ–∫—É–ª–∞',
          '–ú–æ–ª–µ–∫—É–ª–∞+–°–∂–∞—Ç–∏–µ': '–ê—Ç–æ–º',
          '–ê—Ç–æ–º+–°–∂–∞—Ç–∏–µ': '–ö–≤–∞—Ä–∫',
          '–ö–≤–∞—Ä–∫+–°–∂–∞—Ç–∏–µ': '???',
          '–ê—Ç–æ–º+–î–∞–≤–ª–µ–Ω–∏–µ': '–°–∫–æ—Ä–æ—Å—Ç—å',
          '–ú–æ–ª–µ–∫—É–ª–∞+–î–∞–≤–ª–µ–Ω–∏–µ': '–í—Ä–µ–º—è',
          '–ü–æ—á–≤–∞+–û–≥–æ–Ω—å': '–ü–µ—Å–æ–∫',
          '–ü–µ—Å–æ–∫+–û–≥–æ–Ω—å': '–°—Ç–µ–∫–ª–æ',
          '–°—Ç–µ–∫–ª–æ+–í—Ä–µ–º—è': '–ß–∞—Å—ã',
          '–ß–∞—Å—ã+–í–∑—Ä—ã–≤': '–ú–∞—à–∏–Ω–∞ –í—Ä–µ–º–µ–Ω–∏',
          '–ñ–∏–≤–æ—Ç–Ω–æ–µ+–ê—Ç–æ–º': '–¢–∏—Ö–æ—Ö–æ–¥–∫–∞',
          '–ê—Ç–æ–º+–ú–æ–ª–µ–∫—É–ª–∞': '–í—ã—Å–µ—á—å',
          '–¢–∏—Ö–æ—Ö–æ–¥–∫–∞+–í—ã—Å–µ—á—å': '–ë–µ–∑—Å–º–µ—Ä—Ç–∏–µ',
          '–°–∏–ª–∞+–í—ã—Å–µ—á—å': '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ',
          '–í—Ä–µ–º—è+–°–æ–ª–Ω—Ü–µ': '–°—É—Ç–∫–∏',
          '–°—É—Ç–∫–∏+–í—Ä–µ–º—è': '–¶—ã–∫–ª',
          '–¶—ã–∫–ª+–í—Ä–µ–º—è': '–î–µ–Ω—å',
          '–î–µ–Ω—å+–í—Ä–µ–º—è': '–ù–æ—á—å',
          '–°–æ–ª–Ω—Ü–µ+–¶—ã–∫–ª': '–ó–∞–∫–∞—Ç',
          '–ó–∞–∫–∞—Ç+–í—Ä–µ–º—è': '–í–æ—Å—Ö–æ–¥',
          '–ó–µ–º–ª–∏+–í–æ–¥–∞': '–ì–µ–π–∑–µ—Ä',
          '–ù–æ—á—å+–ü–ª–∞–Ω–µ—Ç–∞': '–õ—É–Ω–∞',
          '–õ—É–Ω–∞+–í—ã—Å–µ—á—å': '–°–ø—É—Ç–Ω–∏–∫',
          '–ë–µ–∑—Å–º–µ—Ä—Ç–∏–µ+–í—ã—Å–µ—á—å': '–®—É—Ç–∫–∞',
          '–®—É—Ç–∫–∞+–õ—É–Ω–∞': '–°—ã—Ä',
          '–°—ã—Ä+–ñ–∏–≤–æ—Ç–Ω–æ–µ': '–ö—Ä—ã—Å–∞',
          '–ë–µ–∑—Å–º–µ—Ä—Ç–∏–µ+–ú–∞—à–∏–Ω–∞ –í—Ä–µ–º–µ–Ω–∏': '–ù–µ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ',
          '–ú–∞—Ç–µ—Ä–∏—è+–í–æ–¥–∞': '–ì—É–±–∫–∞',
          '–ì–µ–π–∑–µ—Ä+–í—ã—Å–µ—á—å': '–ü—Ä–æ–±–ª–µ–º–∞',
          '–ö–æ–∑–∞+–®—É—Ç–∫–∞': '–§—É—Ñ–ª–∏–∫',
          '–ì—É–±–∫–∞+–ö—Ä—ã—Å–∞': '–ì–æ—Ñ–º–∞–Ω',
          '–ü—Ä–æ–±–ª–µ–º–∞+–í–∑—Ä—ã–≤': '–¢—Ä–æ–±–ª',
        },
        messages: {
          dragStart: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç "{0}" –Ω–∞ –¥—Ä—É–≥–æ–π',
          selectSecond: '–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç',
          selected: '–í—ã –≤—ã–±—Ä–∞–ª–∏: {0} + {1}',
          newElement: '–ü–æ–ª—É—á–µ–Ω –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç: {0}!',
          failCombine: '–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å "{0}" –∏ "{1}"',
          phoneVersion: 'üì± –í–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤',
          pcVersion: 'üñ•Ô∏è –í–µ—Ä—Å–∏—è –¥–ª—è –ü–ö'
        }
      }
    };

    let phoneMode = localStorage.getItem('phoneMode') === 'true';
    let elements = [];
    let combinations = data.ru.combinations;
    let messages = data.ru.messages;
    let combinationHistory = [];

    const container = document.getElementById('elements');
    const message = document.getElementById('message');
    const toggleModeBtn = document.getElementById('toggleModeBtn');
    const modeText = document.getElementById('modeText');
    const modeIcon = document.getElementById('modeIcon');
    const titleEl = document.getElementById('title');
    const progressBar = document.getElementById('progressBar');
    
    // New elements for combination info
    const basicElementsList = document.getElementById('basicElements');
    const discoveredElementsList = document.getElementById('discoveredElements');
    const combinationHistoryList = document.getElementById('combinationHistory');
    const resultHistoryList = document.getElementById('resultHistory');

    let draggedElement = null;
    let selectedElements = [];

    function loadElements() {
      const saved = localStorage.getItem('elements');
      if (saved) {
        elements = JSON.parse(saved);
      } else {
        elements = [...data.ru.elements];
      }
      
      // Load combination history if exists
      const savedHistory = localStorage.getItem('combinationHistory');
      if (savedHistory) {
        combinationHistory = JSON.parse(savedHistory);
      }
      
      updateProgress();
      updateInfoColumns();
    }

    function saveElements() {
      localStorage.setItem('elements', JSON.stringify(elements));
      localStorage.setItem('phoneMode', phoneMode);
      localStorage.setItem('combinationHistory', JSON.stringify(combinationHistory));
    }

    function updateProgress() {
      const totalElements = Object.keys(combinations).length + data.ru.elements.length;
      const discovered = elements.length;
      const percentage = (discovered / totalElements) * 100;
      progressBar.style.width = `${percentage}%`;
    }
    
    function updateInfoColumns() {
      // Update basic elements
      basicElementsList.innerHTML = '';
      data.ru.elements.forEach(el => {
        const li = document.createElement('li');
        li.textContent = el;
        basicElementsList.appendChild(li);
      });
      
      // Update discovered elements (excluding basic ones)
      discoveredElementsList.innerHTML = '';
      elements.filter(el => !data.ru.elements.includes(el)).forEach(el => {
        const li = document.createElement('li');
        li.textContent = el;
        discoveredElementsList.appendChild(li);
      });
      
      // Update combination history
      combinationHistoryList.innerHTML = '';
      combinationHistory.forEach(entry => {
        const li = document.createElement('li');
        li.textContent = entry.combination;
        combinationHistoryList.appendChild(li);
      });
      
      // Update result history
      resultHistoryList.innerHTML = '';
      combinationHistory.forEach(entry => {
        const li = document.createElement('li');
        li.textContent = entry.result;
        resultHistoryList.appendChild(li);
      });
    }

    function updateElements() {
      container.innerHTML = '';
      elements.forEach(el => {
        const div = document.createElement('div');
        div.className = 'element';
        div.textContent = el;
        div.dataset.name = el;

        if (!phoneMode) {
          div.setAttribute('draggable', 'true');

          div.addEventListener('dragstart', (e) => {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            showMessage(messages.dragStart.replace('{0}', e.target.textContent), 'info');
          });

          div.addEventListener('dragend', (e) => {
            draggedElement = null;
            e.target.classList.remove('dragging');
            clearMessage();
          });

          div.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.target.style.boxShadow = '0 0 0 2px var(--accent)';
          });

          div.addEventListener('dragleave', (e) => {
            e.target.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
          });

          div.addEventListener('drop', (e) => {
            e.preventDefault();
            e.target.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';

            if (draggedElement && draggedElement !== e.target) {
              combineElements(draggedElement.dataset.name, e.target.dataset.name);
            }
          });
        } else {
          div.addEventListener('click', () => {
            if (selectedElements.length < 2 && !selectedElements.includes(el)) {
              selectedElements.push(el);
              div.classList.add('selected');
              if (selectedElements.length === 2) {
                showMessage(messages.selected
                  .replace('{0}', selectedElements[0])
                  .replace('{1}', selectedElements[1]), 'info');
                setTimeout(() => {
                  combineElements(selectedElements[0], selectedElements[1]);
                  clearSelection();
                }, 1000);
              } else {
                showMessage(messages.selectSecond, 'info');
              }
            }
          });
        }

        container.appendChild(div);
      });
    }

    function clearSelection() {
      selectedElements = [];
      const elems = document.querySelectorAll('.element.selected');
      elems.forEach(e => e.classList.remove('selected'));
    }

    function showMessage(text, type) {
      message.textContent = text;
      message.className = '';
      message.classList.add(`message-${type}`);
    }

    function clearMessage() {
      message.textContent = '';
      message.className = '';
    }

    function combineElements(a, b) {
      const key1 = a + '+' + b;
      const key2 = b + '+' + a;

      let result = combinations[key1] || combinations[key2];

      if (result) {
        if (!elements.includes(result)) {
          elements.push(result);
          // Add to history
          combinationHistory.push({
            combination: `${a} + ${b}`,
            result: result
          });
          saveElements();
          updateElements();
          updateProgress();
          updateInfoColumns();
          showMessage(messages.newElement.replace('{0}', result), 'success');
        } else {
          showMessage(`–£–∂–µ –µ—Å—Ç—å: ${result}`, 'info');
        }
      } else {
        showMessage(messages.failCombine.replace('{0}', a).replace('{1}', b), 'error');
      }
    }

    toggleModeBtn.addEventListener('click', () => {
      phoneMode = !phoneMode;
      clearSelection();
      clearMessage();
      modeText.textContent = phoneMode ? messages.pcVersion : messages.phoneVersion;
      modeIcon.textContent = phoneMode ? 'üñ•Ô∏è' : 'üì±';
      saveElements();
      updateElements();
    });

    // Initialize
    loadElements();
    updateElements();
    modeText.textContent = phoneMode ? messages.pcVersion : messages.phoneVersion;
    modeIcon.textContent = phoneMode ? 'üñ•Ô∏è' : 'üì±';
  </script>
</body>
</html>
